# Agentic RAG TG-Bot

Этот проект демонстрирует использование Retrieval-Augmented Generation (RAG) для телеграм-бота. Бот ищет и анализирует содержимое загруженных документов (PDF-файлы, расшифровки YouTube) и формирует ответ, используя LLM.

---

## 1. Описание проекта

- **Ingest данных**: через `ingest.py` можно загружать PDF-файлы или расшифровки с YouTube, чтобы наполнить векторное хранилище (Chroma).
- **RAG-агент**: располагается в `agent.py`. При запросах к боту ищет релевантные куски из хранилища и генерирует ответы.
- **Телеграм-бот**: код в `bot.py`. Принимает сообщения от пользователей и отдаёт их RAG-агенту для ответа.

---

## 2. Подготовка окружения

1. Установите Python версии 3.9+ (рекомендуется).
2. (Опционально) Установите Docker, если хотите деплоить проект в контейнере.
3. Клонируйте репозиторорий с проектом:

    git clone git@github.com:akaUNik/agentic-rag-tg-bot.git  
    cd agentic-rag-tg-bot

4. Убедитесь, что у вас есть файл `.env` (см. раздел «Переменные окружения»), либо создайте его вручную.

---

## 3. Переменные окружения

Файл `.env` может выглядеть так (пример):

    OPENAI_API_KEY=***
    LANGCHAIN_TRACING_V2=true
    LANGCHAIN_API_KEY=****
    LANGCHAIN_PROJECT=agentic-rag-tg-bot
    BOT_TOKEN=***

**Все** эти переменные (особенно токены и ключи API) не должны попадать в публичные репозитории. Не забудьте добавить `.env` в `.gitignore`.

---

## 4. Установка зависимостей

Если планируете запускать проект локально (не через Docker):

    pip install -r requirements.txt

---

## 5. Загрузка данных (ингест)

Пример команды для загрузки PDF-файла:

    python ingest.py pdf/Sber2023.pdf

Пример команды для загрузки расшифровки YouTube:

    python ingest.py "https://www.youtube.com/watch?v=rJLI3J1W_SY"

Файлы/транскрипты будут разбиваться на фрагменты и сохраняться в локальную базу Chroma (по умолчанию в папке `./chromadb`).

---

## 6. Запуск телеграм-бота локально (без Docker)

Убедитесь, что ваш `.env` корректен и всё установлено:

    python bot.py

Бот запустится и начнёт слушать входящие сообщения в Telegram по указанному `BOT_TOKEN`.

---

## 7. Запуск через Docker

В репозитории есть файл `deploy.sh`, который:
1. Останавливает и удаляет текущий контейнер (если он запущен).
2. Достаёт последние изменения из git.
3. Собирает Docker-образ.
4. Запускает новый контейнер.
5. Показывает логи контейнера.

**Использование**:

    chmod +x deploy.sh
    ./deploy.sh

---

## 8. Журналирование (Logging)

- Логи телеграм-бота пишутся в `bot.log`.
- Логи RAG-агента пишутся в `agent.log`.
- Уровень логирования можно менять в `logging.basicConfig(level=logging.DEBUG)` в каждом файле, чтобы видеть более подробную информацию.

---

## 9. Тестирование

Для запуска тестов используйте следующую команду:

    python -m unittest discover

Эта команда автоматически найдёт и выполнит все тесты в проекте, включая модульные тесты для телеграм-бота и RAG-агента.

---

## 10. Дополнительно

- При возникновении проблем убедитесь, что ключи и токены (API ключи OpenAI, телеграм-бота и т. д.) указаны верно.
- Если используете Docker, не забудьте монтировать или копировать нужную папку `chromadb` внутрь контейнера, чтобы база данных не терялась при пересоздании контейнера.

---

## 11. Контакты

- **Разработчик**: Дмитрий Бурдаков
- **Issues**: [https://github.com/akaUNik/agentic-rag-tg-bot](https://github.com/akaUNik/agentic-rag-tg-bot)